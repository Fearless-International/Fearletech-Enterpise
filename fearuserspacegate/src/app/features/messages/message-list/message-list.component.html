<div class="message-list-container">
  <h1 class="page-title">Messages</h1>
  
  <!-- Filters and Actions Bar -->
  <div class="filter-bar">
    <div class="filter-group">
      <span class="p-input-icon-left">
        <i class="pi pi-search"
        style="
      position: absolute;
      left: 12px;
      top: 36%;
      transform: translateY(-50%);
      color: #6b7280;
      z-index: 1;
    "
        ></i>
        <input 
          type="text" 
          pInputText 
          placeholder="Search messages" 
          [(ngModel)]="searchQuery"
          (keyup.enter)="onSearch()"
           style="
      width: 100%;
      padding: 12px 16px 12px 40px;
    "
        />
      </span>
      <button 
        *ngIf="searchQuery" 
        pButton 
        icon="pi pi-times" 
        class="p-button-rounded p-button-text" 
        (click)="clearSearch()"
      ></button>
    </div>
    
    <div class="filter-group">
      <p-dropdown 
        [options]="readOptions" 
        [(ngModel)]="selectedReadStatus" 
        placeholder="Filter by Read Status" 
        (onChange)="onReadStatusChange()"
        [style]="{
          width: '200px',
          'background-color': '#1f2937',
        }"
        [panelStyle]="{
          'background-color': '#363737',
          'padding': '20px',
          color: '#ffffff',
          'border-radius': '8px',
          'box-shadow': '0 4px 6px rgba(0, 0, 0, 0.1)'
        }"
      ></p-dropdown>
    </div>
  </div>
  
  <!-- Messages Table -->
  <p-card>
    <p-table 
      [value]="messages" 
      [loading]="loading" 
      styleClass="p-datatable-sm"
      responsiveLayout="stack"
      [paginator]="false"
      [rows]="rows"
      [showCurrentPageReport]="true"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 50px"></th>
          <th style="min-width: 200px">Sender</th>
          <th style="min-width: 300px">Subject</th>
          <th style="min-width: 120px">Date</th>
          <th style="width: 100px">Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-message>
        <tr 
          [ngClass]="{'unread-message': !message.read}"
          (click)="viewMessage(message.id)"
          class="message-row"
        >
          <td>
            <span class="p-column-title"></span>
            <p-badge *ngIf="!message.read" severity="info" value=" "></p-badge>
          </td>
          <td>
            <span class="p-column-title">Sender</span>
            <div class="sender-info">
              <p-avatar 
                [label]="getInitials(message.sender.name)" 
                [style]="{'background-color': getAvatarColor(message.sender.name)}" 
                shape="circle"
                size="normal"
              ></p-avatar>
              <div class="sender-details">
                <span class="sender-name">{{ message.sender.name }}</span>
                <small class="sender-email">{{ message.sender.email }}</small>
              </div>
            </div>
          </td>
          <td>
            <span class="p-column-title">Subject</span>
            <div class="message-content-preview">
              <span class="message-subject">{{ message.subject }}</span>
              <span class="message-preview">{{ formatPreview(message.content) }}</span>
            </div>
          </td>
          <td>
            <span class="p-column-title">Date</span>
            {{ message.createdAt | date:'medium' }}
          </td>
          <td>
            <span class="p-column-title">Actions</span>
            <div class="action-buttons">
              <button 
                pButton 
                icon="pi pi-eye" 
                class="p-button-rounded p-button-outlined p-button-sm" 
                pTooltip="View Details" 
                tooltipPosition="top" 
                (click)="viewMessage(message.id); $event.stopPropagation();"
              ></button>
              <button 
                *ngIf="!message.read"
                pButton 
                icon="pi pi-check" 
                class="p-button-rounded p-button-outlined p-button-success p-button-sm" 
                pTooltip="Mark as Read" 
                tooltipPosition="top" 
                (click)="markAsRead(message.id, $event)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="empty-message">
            <div *ngIf="loading">
              <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="8" fill="#EEEEEE" animationDuration=".5s"></p-progressSpinner>
              <p>Loading messages...</p>
            </div>
            <div *ngIf="!loading">
              <i class="pi pi-inbox" style="font-size: 3rem"></i>
              <p>No messages found</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
    
    <!-- Pagination -->
    <p-paginator 
      [rows]="rows" 
      [totalRecords]="totalRecords" 
      [rowsPerPageOptions]="[5, 10, 20, 50]"
      (onPageChange)="onPageChange($event)"
      [first]="first"
    ></p-paginator>
  </p-card>
</div>

<p-toast></p-toast>